<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ShuttleWinners by Rana</title>
<style>
/* ================== CSS ================== */
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#1a1a1a 0%,#4a0000 100%);min-height:100vh;}
.container{display:flex;min-height:100vh;}
.menu-toggle{display:none;position:fixed;top:15px;left:15px;z-index:1001;background:linear-gradient(135deg,#c41e3a 0%,#8b0000 100%);color:white;border:none;padding:12px 15px;border-radius:8px;cursor:pointer;font-size:20px;box-shadow:0 4px 15px rgba(196,30,58,0.4);}
.sidebar{width:250px;background:rgba(20,20,20,0.95);backdrop-filter:blur(10px);box-shadow:2px 0 20px rgba(196,30,58,0.3);padding:20px;transition:transform 0.3s ease;border-right:2px solid #c41e3a;}
.logo{text-align:center;margin-bottom:30px;padding-bottom:20px;border-bottom:2px solid #c41e3a;}
.logo h1{color:#c41e3a;font-size:24px;margin-bottom:5px;text-shadow:0 0 10px rgba(196,30,58,0.5);}
.logo p{color:#999;font-size:12px;}
.menu-item{padding:15px 20px;margin:10px 0;border-radius:10px;cursor:pointer;transition:all 0.3s ease;display:flex;align-items:center;gap:10px;color:#ddd;border:1px solid transparent;}
.menu-item:hover{background:linear-gradient(135deg,#c41e3a 0%,#8b0000 100%);color:white;transform:translateX(5px);border-color:#c41e3a;box-shadow:0 4px 15px rgba(196,30,58,0.3);}
.menu-item.active{background:linear-gradient(135deg,#c41e3a 0%,#8b0000 100%);color:white;border-color:#c41e3a;box-shadow:0 4px 15px rgba(196,30,58,0.3);}
.main-content{flex:1;padding:30px;overflow-y:auto;}
.content-section{display:none;animation:fadeIn 0.5s ease;}
.content-section.active{display:block;}
@keyframes fadeIn{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
.card{background:rgba(20,20,20,0.9);border-radius:15px;padding:25px;margin-bottom:20px;box-shadow:0 5px 20px rgba(0,0,0,0.5);border:1px solid #c41e3a;}
.card h2{color:#c41e3a;margin-bottom:20px;font-size:28px;text-shadow:0 0 10px rgba(196,30,58,0.3);}
.tabs-container{display:flex;gap:10px;margin-bottom:25px;flex-wrap:wrap;}
.tab{padding:12px 20px;border-radius:8px;cursor:pointer;background:rgba(40,40,40,0.8);color:#ddd;font-weight:600;transition:all 0.3s ease;border:1px solid #333;flex:1;min-width:120px;text-align:center;}
.tab:hover{background:rgba(60,60,60,0.9);border-color:#c41e3a;}
.tab.active{background:linear-gradient(135deg,#c41e3a 0%,#8b0000 100%);color:white;transform:scale(1.05);border-color:#c41e3a;box-shadow:0 4px 15px rgba(196,30,58,0.4);}
.tab-content{display:none;}
.tab-content.active{display:block;animation:fadeIn 0.4s ease;}
.fixture-table{width:100%;border-collapse:collapse;margin-top:15px;}
.fixture-table th,.fixture-table td{padding:15px;text-align:left;border-bottom:1px solid #333;color:#ddd;}
.fixture-table th{background:linear-gradient(135deg,#c41e3a 0%,#8b0000 100%);color:white;font-weight:600;}
.fixture-table tr:hover{background:rgba(196,30,58,0.1);}
.vs-badge{display:inline-block;background:linear-gradient(135deg,#c41e3a 0%,#8b0000 100%);color:white;padding:5px 15px;border-radius:20px;font-weight:bold;font-size:12px;box-shadow:0 2px 8px rgba(196,30,58,0.3);}
.ranking-table{width:100%;border-collapse:collapse;margin-top:15px;}
.ranking-table th,.ranking-table td{padding:15px;text-align:left;border-bottom:1px solid #333;color:#ddd;}
.ranking-table th{background:linear-gradient(135deg,#c41e3a 0%,#8b0000 100%);color:white;font-weight:600;}
.rank-badge{display:inline-flex;align-items:center;justify-content:center;width:35px;height:35px;border-radius:50%;font-weight:bold;color:white;}
.rank-1{background:linear-gradient(135deg,#FFD700,#FFA500);box-shadow:0 0 15px rgba(255,215,0,0.5);}
.rank-2{background:linear-gradient(135deg,#C0C0C0,#A8A8A8);}
.rank-3{background:linear-gradient(135deg,#CD7F32,#B8860B);}
.rank-other{background:linear-gradient(135deg,#c41e3a,#8b0000);}
.form-group{margin-bottom:20px;}
.form-group label{display:block;margin-bottom:8px;color:#ddd;font-weight:600;}
.form-group input,.form-group select{width:100%;padding:12px 15px;border:2px solid #333;border-radius:8px;font-size:14px;background:rgba(40,40,40,0.8);color:#ddd;}
.form-group input:focus,.form-group select:focus{outline:none;border-color:#c41e3a;box-shadow:0 0 10px rgba(196,30,58,0.3);}
.btn{padding:12px 30px;border:none;border-radius:8px;font-size:16px;font-weight:600;cursor:pointer;transition:all 0.3s ease;}
.btn-primary{background:linear-gradient(135deg,#c41e3a 0%,#8b0000 100%);color:white;box-shadow:0 4px 15px rgba(196,30,58,0.3);}
.btn-primary:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(196,30,58,0.5);}
.btn-success{background:linear-gradient(135deg,#c41e3a 0%,#8b0000 100%);color:white;}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);z-index:1000;align-items:center;justify-content:center;}
.modal.active{display:flex;}
.modal-content{background:rgba(20,20,20,0.95);padding:40px;border-radius:15px;width:90%;max-width:400px;box-shadow:0 10px 40px rgba(196,30,58,0.5);border:2px solid #c41e3a;}
.modal-content h2{color:#c41e3a;margin-bottom:25px;}
.notification{position:fixed;top:20px;right:20px;padding:15px 25px;border-radius:8px;color:white;font-weight:600;z-index:2000;animation:slideIn 0.3s ease;box-shadow:0 5px 20px rgba(0,0,0,0.5);}
.notification.success{background:linear-gradient(135deg,#c41e3a 0%,#8b0000 100%);}
.notification.error{background:linear-gradient(135deg,#8b0000 0%,#4a0000 100%);}
@keyframes slideIn{from{transform:translateX(400px);opacity:0;}to{transform:translateX(0);opacity:1;}}
.admin-only{display:none;}
.score-input{width:60px;padding:8px;border:2px solid #333;border-radius:5px;text-align:center;background:rgba(40,40,40,0.8);color:#ddd;}
.edit-btn,.delete-btn{padding:8px 15px;margin:0 5px;border:none;border-radius:5px;cursor:pointer;font-size:12px;font-weight:600;}
.edit-btn{background:#c41e3a;color:white;}
.delete-btn{background:#8b0000;color:white;}
.no-matches{text-align:center;padding:40px;color:#999;font-style:italic;}
@media(max-width:768px){.menu-toggle{display:block;}.sidebar{position:fixed;left:-250px;top:0;height:100vh;z-index:100;}.sidebar.mobile-open{transform:translateX(250px);}.main-content{padding:70px 15px 15px 15px;}.card{padding:15px;}.card h2{font-size:22px;}.tabs-container{gap:5px;}.tab{padding:10px 12px;font-size:13px;min-width:80px;}.fixture-table th,.fixture-table td{padding:10px 5px;font-size:13px;}.ranking-table th,.ranking-table td{padding:10px 8px;font-size:13px;}.form-group input,.form-group select{font-size:16px;}.modal-content{padding:25px;width:95%;}}
@media(max-width:480px){.logo h1{font-size:20px;}.tab{padding:8px 10px;font-size:12px;min-width:70px;}.vs-badge{padding:4px 10px;font-size:10px;}}
</style>
</head>
<body>

<button class="menu-toggle" onclick="toggleMenu()">‚ò∞</button>
<div class="container">
  <div class="sidebar" id="sidebar">
    <div class="logo"><h1>üè∏ ShuttleWinners</h1><p>by Rana</p></div>
    <div class="menu-item active" onclick="goToSection(event,'fixture')">üìã Fixture</div>
    <div class="menu-item" onclick="goToSection(event,'ranking')">üèÜ Ranking</div>
    <div class="menu-item" onclick="openLogin()">üîê Admin Login</div>
    <div class="menu-item admin-only" onclick="goToSection(event,'manage-teams')">üë• Manage Teams</div>
    <div class="menu-item admin-only" onclick="goToSection(event,'manage-matches')">‚öîÔ∏è Manage Matches</div>
    <div class="menu-item admin-only" onclick="doLogout()">üö™ Logout</div>
  </div>

  <div class="main-content">
    <!-- Fixture Section -->
    <div class="content-section active" id="fixture">
      <div class="card">
        <h2>Tournament Fixtures</h2>
        <div class="tabs-container">
          <div class="tab active" onclick="switchDay(event,1)">Day 1</div>
          <div class="tab" onclick="switchDay(event,2)">Day 2</div>
          <div class="tab" onclick="switchDay(event,3)">Day 3</div>
          <div class="tab" onclick="switchDay(event,4)">Final</div>
        </div>
        <div class="tab-content active" id="day-1">
          <table class="fixture-table">
            <thead><tr><th>Match</th><th>Team 1</th><th></th><th>Team 2</th><th>Score</th></tr></thead>
            <tbody id="day1Body"></tbody>
          </table>
        </div>
        <div class="tab-content" id="day-2">
          <table class="fixture-table">
            <thead><tr><th>Match</th><th>Team 1</th><th></th><th>Team 2</th><th>Score</th></tr></thead>
            <tbody id="day2Body"></tbody>
          </table>
        </div>
        <div class="tab-content" id="day-3">
          <table class="fixture-table">
            <thead><tr><th>Match</th><th>Team 1</th><th></th><th>Team 2</th><th>Score</th></tr></thead>
            <tbody id="day3Body"></tbody>
          </table>
        </div>
        <div class="tab-content" id="day-4">
          <table class="fixture-table">
            <thead><tr><th>Match</th><th>Team 1</th><th></th><th>Team 2</th><th>Score</th></tr></thead>
            <tbody id="day4Body"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Ranking Section -->
    <div class="content-section" id="ranking">
      <div class="card">
        <h2>Team Rankings</h2>
        <table class="ranking-table">
          <thead><tr><th>Rank</th><th>Team</th><th>P</th><th>W</th><th>L</th><th>Pts</th></tr></thead>
          <tbody id="rankingBody"></tbody>
        </table>
      </div>
    </div>

    <!-- Admin Sections -->
    <div class="content-section admin-only" id="manage-teams">
      <div class="card">
        <h2>Create Team</h2>
        <form id="createTeamForm">
          <div class="form-group">
            <label>Team Name</label>
            <input type="text" id="teamName" required>
          </div>
          <div class="form-group">
            <label>Icon</label>
            <input type="text" id="teamIcon" placeholder="Emoji">
          </div>
          <button type="submit" class="btn btn-primary">Create</button>
        </form>
      </div>
      <div class="card">
        <h2>Teams</h2>
        <table class="ranking-table">
          <thead><tr><th>Icon</th><th>Name</th><th>Actions</th></tr></thead>
          <tbody id="teamsBody"></tbody>
        </table>
      </div>
    </div>

    <div class="content-section admin-only" id="manage-matches">
      <div class="card">
        <h2>Create Match</h2>
        <form id="createMatchForm">
          <div class="form-group">
            <label>Day</label>
            <input type="number" id="matchDay" min="1" max="4" required>
          </div>
          <div class="form-group">
            <label>Match Number</label>
            <input type="number" id="matchNumber" min="1">
          </div>
          <div class="form-group">
            <label>Team 1</label>
            <select id="team1Select" required></select>
          </div>
          <div class="form-group">
            <label>Team 2</label>
            <select id="team2Select" required></select>
          </div>
          <div class="form-group">
            <label>Type</label>
            <select id="matchType">
              <option value="league">League</option>
              <option value="final">Final</option>
            </select>
          </div>
          <button type="submit" class="btn btn-primary">Create</button>
        </form>
      </div>
      <div class="card">
        <h2>Update Scores</h2>
        <div id="matchScores"></div>
      </div>
    </div>
  </div>
</div>

<!-- Login Modal -->
<div class="modal" id="loginModal">
  <div class="modal-content">
    <h2>Admin Login</h2>
    <form id="loginForm" onsubmit="event.preventDefault(); loginAdmin();">
      <div class="form-group">
        <label>Username (Email)</label>
        <input type="email" id="username" required>
      </div>
      <div class="form-group">
        <label>Password</label>
        <input type="password" id="password" required>
      </div>
      <button type="submit" class="btn btn-primary" style="width:100%">Login</button>
      <button type="button" class="btn" style="width:100%;margin-top:10px;background:#333;color:#ddd" onclick="closeLogin()">Cancel</button>
    </form>
  </div>
</div>

<script type="module">
// ================== Firebase ==================
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
import { getDatabase, ref, set, push, onValue, update } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js";
import { getAuth, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyCSi6Sc3sz_-gNP69sA0MnYH3c-k9_wl9Q",
  authDomain: "shuttlewinnersrana.firebaseapp.com",
  databaseURL: "https://shuttlewinnersrana-default-rtdb.firebaseio.com",
  projectId: "shuttlewinnersrana",
  storageBucket: "shuttlewinnersrana.appspot.com",
  messagingSenderId: "1017505857282",
  appId: "1:1017505857282:web:e34dad05c6dd7d967d4c1b"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);
let isAdmin=false;
let teamsMap={};

// ================== Utility Functions ==================
function notify(msg,type='success'){
  const n=document.createElement('div');n.className='notification '+type;n.textContent=msg;document.body.appendChild(n);setTimeout(()=>n.remove(),3000);
}
function toggleMenu(){document.getElementById('sidebar').classList.toggle('mobile-open');}
function goToSection(event,id){
  document.querySelectorAll('.content-section').forEach(s=>s.classList.remove('active'));
  document.querySelectorAll('.menu-item').forEach(m=>m.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  if(event && event.target) event.target.classList.add('active');
  if(window.innerWidth<=768)document.getElementById('sidebar').classList.remove('mobile-open');
  if(id==='fixture') loadFixtures();
  if(id==='ranking') loadRankings();
  if(id==='manage-teams') loadTeams();
  if(id==='manage-matches') loadMatches();
}
function switchDay(event,d){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
  if(event && event.target) event.target.classList.add('active');
  document.getElementById('day-'+d).classList.add('active');
}
function openLogin(){document.getElementById('loginModal').classList.add('active');}
function closeLogin(){document.getElementById('loginModal').classList.remove('active');}

// ================== Load Teams Map ==================
function loadTeamsMap(){
  onValue(ref(db,'teams'), snapshot=>{
    teamsMap={};
    snapshot.forEach(snap=>{
      teamsMap[snap.key]=snap.val();
    });
  });
}
loadTeamsMap();

// ================== Admin ==================
window.loginAdmin=function(){
  const email=document.getElementById('username').value;
  const password=document.getElementById('password').value;
  signInWithEmailAndPassword(auth,email,password).then(user=>{
    if(user.user.email==='guharoytirthankar@gmail.com'){
      isAdmin=true;
      document.querySelectorAll('.admin-only').forEach(el=>el.style.display='block');
      notify('Admin login successful!');
      closeLogin();
      document.getElementById('loginForm').reset();
    } else {
      signOut(auth);
      notify('Not authorized','error');
    }
  }).catch(e=>notify('Invalid credentials','error'));
}
window.doLogout=function(){
  signOut(auth).then(()=>{
    isAdmin=false;
    document.querySelectorAll('.admin-only').forEach(el=>el.style.display='none');
    notify('Logged out');
    goToSection(null,'fixture');
  });
}

// ================== Fixtures ==================
function loadFixtures(){
  for(let d=1;d<=4;d++) loadDay(d);
}
function loadDay(d){
  onValue(ref(db,'matches'),snapshot=>{
    const tbody=document.getElementById('day'+d+'Body');
    let html='';
    snapshot.forEach(snap=>{
      const m=snap.val();
      if(m.day===d){
        const team1 = teamsMap[m.t1] || {name:m.t1,icon:'üè∏'};
        const team2 = teamsMap[m.t2] || {name:m.t2,icon:'üè∏'};
        let score='- -';
        if(m.s1!==null && m.s1!==undefined && m.s2!==null && m.s2!==undefined) score=`${m.s1} - ${m.s2}`;
        html+=`<tr>
          <td>${m.type==='final'?'FINAL':'Match '+m.num}</td>
          <td>${team1.icon} ${team1.name}</td>
          <td><span class="vs-badge">VS</span></td>
          <td>${team2.icon} ${team2.name}</td>
          <td>${score}</td>
        </tr>`;
      }
    });
    if(!html) html='<tr><td colspan="5" class="no-matches">No matches</td></tr>';
    tbody.innerHTML=html;
  });
}

// ================== Rankings ==================
let rankingTeamsData={};
let rankingListeners={teams:null,matches:null};
function loadRankings(){
  const rBody=document.getElementById('rankingBody');

  function renderRankings(){
    const rankArray=Object.values(rankingTeamsData).sort((a,b)=>{
      if(b.pts!==a.pts) return b.pts - a.pts;
      if(b.w!==a.w) return b.w - a.w;
      return a.name.localeCompare(b.name);
    });
    let html='';
    if(rankArray.length===0) html='<tr><td colspan="6" class="no-matches">No teams</td></tr>';
    else{
      rankArray.forEach((t,i)=>{
        const c=i===0?'rank-1':i===1?'rank-2':i===2?'rank-3':'rank-other';
        html+=`<tr><td><span class="rank-badge ${c}">${i+1}</span></td><td>${t.icon} ${t.name}</td><td>${t.p}</td><td>${t.w}</td><td>${t.l}</td><td>${t.pts}</td></tr>`;
      });
    }
    rBody.innerHTML=html;
  }

  function processMatches(mSnap){
    Object.keys(rankingTeamsData).forEach(k=>{rankingTeamsData[k].p=0;rankingTeamsData[k].w=0;rankingTeamsData[k].l=0;rankingTeamsData[k].pts=0;});
    if(mSnap && mSnap.exists()){
      mSnap.forEach(s=>{
        const m=s.val();
        if(m && m.type==='league' && m.s1!==null && m.s2!==null){
          if(rankingTeamsData[m.t1] && rankingTeamsData[m.t2]){
            rankingTeamsData[m.t1].p++; rankingTeamsData[m.t2].p++;
            if(m.s1>m.s2){rankingTeamsData[m.t1].w++;rankingTeamsData[m.t1].pts+=2;rankingTeamsData[m.t2].l++;}
            else if(m.s2>m.s1){rankingTeamsData[m.t2].w++;rankingTeamsData[m.t2].pts+=2;rankingTeamsData[m.t1].l++;}
          }
        }
      });
    }
    renderRankings();
  }

  if(rankingListeners.teams) rankingListeners.teams();
  if(rankingListeners.matches) rankingListeners.matches();

  rankingListeners.teams = onValue(ref(db,'teams'),tSnap=>{
    rankingTeamsData={};
    if(tSnap.exists()){tSnap.forEach(s=>{rankingTeamsData[s.key]={...s.val(),p:0,w:0,l:0,pts:0};});}
    if(rankingListeners.matches) rankingListeners.matches();
    rankingListeners.matches = onValue(ref(db,'matches'),mSnap=>{processMatches(mSnap);});
  });
}

// ================== Teams & Matches ==================
function loadTeams(){
  const teamsBody=document.getElementById('teamsBody');
  onValue(ref(db,'teams'),snapshot=>{
    teamsBody.innerHTML='';
    snapshot.forEach(child=>{
      const t=child.val();
      teamsBody.innerHTML+=`<tr><td>${t.icon}</td><td>${t.name}</td><td><button class="delete-btn" onclick="deleteTeam('${child.key}')">Delete</button></td></tr>`;
    });
    loadTeamsMap();
  });
}
window.deleteTeam=function(key){if(!isAdmin)return notify('Not authorized','error');set(ref(db,'teams/'+key),null).then(()=>{loadTeamsMap();notify('Team deleted');});}
document.getElementById('createTeamForm').addEventListener('submit',function(e){
  e.preventDefault();
  if(!isAdmin)return notify('Not authorized','error');
  const name=document.getElementById('teamName').value;
  const icon=document.getElementById('teamIcon').value||'üè∏';
  push(ref(db,'teams'),{name,icon}).then(()=>{loadTeamsMap();notify('Team created');this.reset();});
});

function loadMatches(){
  const t1Select=document.getElementById('team1Select');
  const t2Select=document.getElementById('team2Select');
  t1Select.innerHTML=t2Select.innerHTML='';
  onValue(ref(db,'teams'),snapshot=>{
    t1Select.innerHTML=t2Select.innerHTML='<option value="">Select Team</option>';
    snapshot.forEach(s=>{const t=s.val();t1Select.innerHTML+=`<option value="${s.key}">${t.icon} ${t.name}</option>`;t2Select.innerHTML+=`<option value="${s.key}">${t.icon} ${t.name}</option>`;});
  });

  const matchScoresDiv=document.getElementById('matchScores');
  onValue(ref(db,'matches'),snapshot=>{
    matchScoresDiv.innerHTML='';
    snapshot.forEach(snap=>{
      const m=snap.val();
      if(m.type==='league'){
        const team1=teamsMap[m.t1]||{name:m.t1,icon:'üè∏'};
        const team2=teamsMap[m.t2]||{name:m.t2,icon:'üè∏'};
        const s1=m.s1!==null&&m.s1!==undefined?m.s1:'';const s2=m.s2!==null&&m.s2!==undefined?m.s2:'';
        matchScoresDiv.innerHTML+=`<div style="margin-bottom:10px;"><strong>Match ${m.num}:</strong> ${team1.icon} ${team1.name} <input class="score-input" id="s1_${snap.key}" value="${s1}"> - <input class="score-input" id="s2_${snap.key}" value="${s2}"> ${team2.icon} ${team2.name} <button class="btn btn-success" onclick="updateScore('${snap.key}')">Update</button></div>`;
      }
    });
  });
}
window.updateScore=function(key){if(!isAdmin)return notify('Not authorized','error');const s1=parseInt(document.getElementById('s1_'+key).value)||0;const s2=parseInt(document.getElementById('s2_'+key).value)||0;update(ref(db,'matches/'+key),{s1,s2});notify('Score updated');}
document.getElementById('createMatchForm').addEventListener('submit',function(e){
  e.preventDefault();
  if(!isAdmin)return notify('Not authorized','error');
  const day=parseInt(document.getElementById('matchDay').value);
  const num=parseInt(document.getElementById('matchNumber').value);
  const t1=document.getElementById('team1Select').value;
  const t2=document.getElementById('team2Select').value;
  const type=document.getElementById('matchType').value;
  if(!t1||!t2)return notify('Select both teams','error');
  push(ref(db,'matches'),{day,num,t1,t2,type,s1:null,s2:null});
  notify('Match created');this.reset();
});

// ================== Load on start ==================
window.addEventListener('load',()=>{loadTeamsMap();goToSection(null,'fixture');});

</script>
</body>
</html>
